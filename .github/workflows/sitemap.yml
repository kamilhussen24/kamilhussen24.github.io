name: Sitemap Auto Update

on:
  schedule:
    - cron: '0 0 * * *'  # দৈনিক স্বয়ংক্রিয় আপডেট
  workflow_dispatch:     # ম্যানুয়ালি যখন ইচ্ছা তখন রান করার অপশন

permissions:
  contents: write

jobs:
  generate-sitemap:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GH_PAT }}

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Generate Fresh Sitemap
      run: |
        # পুরানো সাইটম্যাপ ডিলিট করে সম্পূর্ণ নতুন করে তৈরি
        rm -f sitemap.xml
        python .github/scripts/sitemap_generator.py --force

    - name: Force Update Sitemap
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        git add sitemap.xml
        git commit -m "COMPLETE sitemap rebuild [skip ci]"
        
        # জোর করে পুশ (শুধু sitemap.xml ফাইলটির জন্য)
        git push origin main --force
